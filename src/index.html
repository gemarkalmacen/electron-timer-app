<!--
=========================================================
* Argon Dashboard - v1.2.0
=========================================================
* Product Page: https://www.creative-tim.com/product/argon-dashboard


* Copyright  Creative Tim (http://www.creative-tim.com)
* Coded by www.creative-tim.com



=========================================================
* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Start your development with a Dashboard for Bootstrap 4.">
  <meta name="author" content="Creative Tim">
  <meta name="csrf-token" content="">
  <title>Splace | Time Tacker</title>
  <!-- Favicon -->
  <link rel="icon" href="assets/img/brand/favicon.png" type="image/png">
  <!-- Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700">
  <!-- Icons -->
  <link rel="stylesheet" href="assets/vendor/nucleo/css/nucleo.css" type="text/css">
  <link rel="stylesheet" href="assets/vendor/@fortawesome/fontawesome-free/css/all.min.css" type="text/css">
  <!-- Page plugins -->
  <!-- Argon CSS -->
  <link rel="stylesheet" href="assets/css/argon.css?v=1.2.0" type="text/css">
  <style>
    body {
      overflow-x: hidden;
    }
    ::-webkit-scrollbar {
    display: none;
    }
    .is-red{
        background: red;
    }
    .is-blue{
        background: green;
    }
    .is-white{
        background: white;
    }
  </style>
</head>

<body>
  <!-- Main content -->
  <div id="app">
  <div class="main-content" id="panel">
    <!-- Topnav -->
    <nav class="navbar navbar-top navbar-expand navbar-dark bg-primary border-bottom">
      <div class="container-fluid">
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <!-- Search form -->
          <form class="navbar-search navbar-search-light form-inline mr-sm-3" id="navbar-search-main">
            <div class="form-group mb-0">
              <div class="input-group input-group-alternative input-group-merge">
                <div class="input-group-prepend">
                  <span class="input-group-text"><i class="fas fa-search"></i></span>
                </div>
                <input class="form-control" placeholder="Search" type="text">
              </div>
            </div>
            <button type="button" class="close" data-action="search-close" data-target="#navbar-search-main" aria-label="Close">
              <span aria-hidden="true">Ã—</span>
            </button>
          </form>
          <!-- Navbar links -->
          <ul class="navbar-nav align-items-center  ml-md-auto ">
            <li class="nav-item d-xl-none">
              <a class="nav-link" href="#" data-action="search-show" data-target="#navbar-search-main">
                <i class="ni ni-zoom-split-in"></i>
              </a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="ni ni-bell-55"></i>
              </a>
              <div class="dropdown-menu dropdown-menu-xl  dropdown-menu-right  py-0 overflow-hidden">
                <!-- Dropdown header -->
                <div class="px-3 py-3">
                  <h6 class="text-sm text-muted m-0">You have <strong class="text-primary">13</strong> notifications.</h6>
                </div>
                <!-- List group -->
                <div class="list-group list-group-flush">
                  <a href="#!" class="list-group-item list-group-item-action">
                    <div class="row align-items-center">
                      <div class="col-auto">
                        <!-- Avatar -->
                        <img alt="Image placeholder" src="assets/img/theme/team-1.jpg" class="avatar rounded-circle">
                      </div>
                      <div class="col ml--2">
                        <div class="d-flex justify-content-between align-items-center">
                          <div>
                            <h4 class="mb-0 text-sm">John Snow</h4>
                          </div>
                          <div class="text-right text-muted">
                            <small>2 hrs ago</small>
                          </div>
                        </div>
                        <p class="text-sm mb-0">Let's meet at Starbucks at 11:30. Wdyt?</p>
                      </div>
                    </div>
                  </a>
                  <a href="#!" class="list-group-item list-group-item-action">
                    <div class="row align-items-center">
                      <div class="col-auto">
                        <!-- Avatar -->
                        <img alt="Image placeholder" src="assets/img/theme/team-2.jpg" class="avatar rounded-circle">
                      </div>
                      <div class="col ml--2">
                        <div class="d-flex justify-content-between align-items-center">
                          <div>
                            <h4 class="mb-0 text-sm">John Snow</h4>
                          </div>
                          <div class="text-right text-muted">
                            <small>3 hrs ago</small>
                          </div>
                        </div>
                        <p class="text-sm mb-0">A new issue has been reported for Argon.</p>
                      </div>
                    </div>
                  </a>
                  <a href="#!" class="list-group-item list-group-item-action">
                    <div class="row align-items-center">
                      <div class="col-auto">
                        <!-- Avatar -->
                        <img alt="Image placeholder" src="assets/img/theme/team-3.jpg" class="avatar rounded-circle">
                      </div>
                      <div class="col ml--2">
                        <div class="d-flex justify-content-between align-items-center">
                          <div>
                            <h4 class="mb-0 text-sm">John Snow</h4>
                          </div>
                          <div class="text-right text-muted">
                            <small>5 hrs ago</small>
                          </div>
                        </div>
                        <p class="text-sm mb-0">Your posts have been liked a lot.</p>
                      </div>
                    </div>
                  </a>
                  <a href="#!" class="list-group-item list-group-item-action">
                    <div class="row align-items-center">
                      <div class="col-auto">
                        <!-- Avatar -->
                        <img alt="Image placeholder" src="assets/img/theme/team-4.jpg" class="avatar rounded-circle">
                      </div>
                      <div class="col ml--2">
                        <div class="d-flex justify-content-between align-items-center">
                          <div>
                            <h4 class="mb-0 text-sm">John Snow</h4>
                          </div>
                          <div class="text-right text-muted">
                            <small>2 hrs ago</small>
                          </div>
                        </div>
                        <p class="text-sm mb-0">Let's meet at Starbucks at 11:30. Wdyt?</p>
                      </div>
                    </div>
                  </a>
                  <a href="#!" class="list-group-item list-group-item-action">
                    <div class="row align-items-center">
                      <div class="col-auto">
                        <!-- Avatar -->
                        <img alt="Image placeholder" src="assets/img/theme/team-5.jpg" class="avatar rounded-circle">
                      </div>
                      <div class="col ml--2">
                        <div class="d-flex justify-content-between align-items-center">
                          <div>
                            <h4 class="mb-0 text-sm">John Snow</h4>
                          </div>
                          <div class="text-right text-muted">
                            <small>3 hrs ago</small>
                          </div>
                        </div>
                        <p class="text-sm mb-0">A new issue has been reported for Argon.</p>
                      </div>
                    </div>
                  </a>
                </div>
                <!-- View all -->
                <a href="#!" class="dropdown-item text-center text-primary font-weight-bold py-3">View all</a>
              </div>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="ni ni-ungroup"></i>
              </a>
              <div class="dropdown-menu dropdown-menu-lg dropdown-menu-dark bg-default  dropdown-menu-right ">
                <div class="row shortcuts px-4">
                  <a href="#!" class="col-4 shortcut-item">
                    <span class="shortcut-media avatar rounded-circle bg-gradient-red">
                      <i class="ni ni-calendar-grid-58"></i>
                    </span>
                    <small>Calendar</small>
                  </a>
                  <a href="#!" class="col-4 shortcut-item">
                    <span class="shortcut-media avatar rounded-circle bg-gradient-orange">
                      <i class="ni ni-email-83"></i>
                    </span>
                    <small>Email</small>
                  </a>
                  <a href="#!" class="col-4 shortcut-item">
                    <span class="shortcut-media avatar rounded-circle bg-gradient-info">
                      <i class="ni ni-credit-card"></i>
                    </span>
                    <small>Payments</small>
                  </a>
                  <a href="#!" class="col-4 shortcut-item">
                    <span class="shortcut-media avatar rounded-circle bg-gradient-green">
                      <i class="ni ni-books"></i>
                    </span>
                    <small>Reports</small>
                  </a>
                  <a href="#!" class="col-4 shortcut-item">
                    <span class="shortcut-media avatar rounded-circle bg-gradient-purple">
                      <i class="ni ni-pin-3"></i>
                    </span>
                    <small>Maps</small>
                  </a>
                  <a href="#!" class="col-4 shortcut-item">
                    <span class="shortcut-media avatar rounded-circle bg-gradient-yellow">
                      <i class="ni ni-basket"></i>
                    </span>
                    <small>Shop</small>
                  </a>
                </div>
              </div>
            </li>
          </ul>
          <ul class="navbar-nav align-items-center  ml-auto ml-md-0 ">
            <li class="nav-item dropdown">
              <a class="nav-link pr-0" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <div class="media align-items-center">
                  <span class="avatar avatar-sm rounded-circle">
                    <img alt="Image placeholder" src="assets/img/theme/team-4.jpg">
                  </span>
                  <div class="media-body  ml-2  d-none d-lg-block">
                    <span class="mb-0 text-sm  font-weight-bold">John Snow</span>
                  </div>
                </div>
              </a>
              <div class="dropdown-menu  dropdown-menu-right ">
                <div class="dropdown-header noti-title">
                  <h6 class="text-overflow m-0">Welcome!</h6>
                </div>
                <a href="#!" class="dropdown-item">
                  <i class="ni ni-single-02"></i>
                  <span>My profile</span>
                </a>
                <a href="#!" class="dropdown-item">
                  <i class="ni ni-settings-gear-65"></i>
                  <span>Settings</span>
                </a>
                <a href="#!" class="dropdown-item">
                  <i class="ni ni-calendar-grid-58"></i>
                  <span>Activity</span>
                </a>
                <a href="#!" class="dropdown-item">
                  <i class="ni ni-support-16"></i>
                  <span>Support</span>
                </a>
                <div class="dropdown-divider"></div>
                <a href="login.html" class="dropdown-item">
                  <i class="ni ni-user-run"></i>
                  <span>Logout</span>
                </a>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- Header -->
    <!-- Header -->
    <input type="hidden" name="_token" id="_token" value=""/>
    <div class="header bg-primary pb-6">
      <div class="container-fluid">
        <div class="header-body">
          <!-- Card stats -->
          <div class="row">
            <div class="col-xl-3 col-md-6 mt-5">
              <div class="card card-stats">
                <!-- Card body -->
                <div class="card-body">
                  <div class="row">
                    <div class="col">
                      <!-- <span class="h1 font-weight-bold mb-0" id="timer">0</span> -->
                      <employee-timer-elapsed-time 
                          :from="time_in_date" 
                          :status="timer_status" 
                          :break_duration="break_duration" 
                          v-if="time_in_date"
                      >
                      </employee-timer-elapsed-time>
                    </div>
                    <div class="col-auto">
                      <!-- <a href="#" class="btn btn-sm btn-neutral" v-if="logStatus === 'Check-in'" @click="btnLogCheckIn">Check-in</a>
                      <a href="#" class="btn btn-sm btn-neutral" v-else @click="btnLogCheckOut">Check-out</a> -->
                      <button
                        @click="changeTimeInStatus(timer_status)"
                        :disabled="disable_checkStatus == true"
                        class="btn btn-secondary"
                      >
                        {{ checkStatus }}<br>
                        <!-- {{ dateText(time_in_date) }} -->
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-6 col-7 mb-2">
              <h6 class="h2 text-white d-inline-block mb-0">Breaks</h6>              
            </div>

            <employee-break-timer 
                :status="is_break" 
                :time_limit="break_time_limit"
                v-if="is_break"
                v-on:change="updateRemainingTime($event)"
                :break_id="current_break_id"
            >                
            </employee-break-timer>

            <div class="row">
                <div  class="col-md-12" v-for="breakList in break_list" :key="breakList.id">   
                    <div class="col-xl-3 col-md-6"  >
                      <div class="card card-stats">
                          <div class="card-body">
                            <div class="row">
                                <div class="col">
                                    <h5 class="card-title text-uppercase text-muted mb-0">{{ breakList.name }}</h5>
                                    <span class="h1 font-weight-bold mb-0" :id="breakList.id">{{ breakList.break_time }}</span>
                                </div>
                                <div class="col-auto">
                                    <button 
                                        class="btn btn-icon btn-secondary icon icon-shape bg-gradient-orange text-white rounded-circle shadow" 
                                        type="button"
                                        @click="changeBreakStatus(breakList)"   
                                        v-if="breakList.status != null"
                                        :key='breakList.id'
                                        :disabled="is_check_in == false || breakList.is_disabled == true"
                                    >
                                        <span class="btn-inner--icon">
                                            <i 
                                                :class="checkBreakStatusIcon(breakList.status)"
                                            >
                                            </i>
                                        </span>
                                    </button>
                                    <!-- <div 
                                        class="icon icon-shape bg-gradient-orange text-white rounded-circle shadow"
                                        @click="changeBreakStatus(breakList)"   
                                        v-if="breakList.status != null"
                                        :key='breakList.id'
                                        :disabled="is_check_in == false || breakList.is_disabled == true"
                                    >
                                        <i 
                                            :class="checkBreakStatusIcon(breakList.status)"
                                        ></i>
                                    </div> -->
                                    <!-- <div @click="radioBreakPause(breakList)" class="icon icon-shape bg-gradient-orange text-white rounded-circle shadow">
                                        <i class="ni ni-button-pause"></i>
                                    </div> -->
                                </div>
                            </div>
                          </div>
                      </div>
                    </div>
                </div>            
            </div>

            <!-- <div class="row">
                <div class="col-md-12"
                  v-for="breakList in break_list" :key="breakList.id"
                  style="display:block"
                >
                  <button 
                      style="margin-bottom: 20px; margin-left: 40px;"
                      @click="changeBreakStatus(breakList)"      
                      v-if="breakList.status != null"
                      :key='breakList.id'
                      :class="checkBreakStatus(breakList.status)"
                      :disabled="is_check_in == false || breakList.is_disabled == true"
                    >
                    {{ breakList.name }}
                    {{ breakList.break_time }} mins
                  </button>
                </div>
            </div>             -->
         
              <!-- <div class="col-xl-3 col-md-6" v-for="break in breakList" :key="break.id">
                <div class="card card-stats">
                  <div class="card-body">
                    <div class="row">
                      <div class="col">
                        <h5 class="card-title text-uppercase text-muted mb-0">{{ break.name }}</h5>
                        <span class="h1 font-weight-bold mb-0">{{ break.break_time }}</span>
                      </div>
                      <div class="col-auto">
                        <div class="icon icon-shape bg-gradient-orange text-white rounded-circle shadow">
                          <i class="ni ni-chart-pie-35"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div> -->
          
           

            <div id="breakContent" class="col-xl-3 col-md-6">

            </div>
          
      
            

          </div>
        </div>
      </div>
    </div>
    <!-- Page content -->
   
  </div>
</div>
  <!-- Argon Scripts -->
  <!-- Core -->
  <script src="assets/vendor/jquery/dist/jquery.min.js"></script>
  <script src="assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/js-cookie/js.cookie.js"></script>
  <script src="assets/vendor/jquery.scrollbar/jquery.scrollbar.min.js"></script>
  <script src="assets/vendor/jquery-scroll-lock/dist/jquery-scrollLock.min.js"></script>
  <!-- Argon JS -->
  <script src="assets/js/argon.js?v=1.2.0"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
 
  <script src="assets/js/moment.js"></script>
  <script src="assets/js/require.js"></script>
  <script>
    Vue.component('employee-timer-elapsed-time', {
      template: '<h1>{{time}}</h1>',
      data() {
          return {
              interval:null,
              days:0,
              hours:0,
              minutes:0,
              seconds:0,
              time: "",
              intervals:{
                  second: 1000,
                  minute: 1000 * 60,
                  hour: 1000 * 60 * 60,
                  day: 1000 * 60 * 60 * 24
              },
              increment_count: 0,
          }
      },
      props:{
          from : {
              required:true
          },
          status : {
              required:true
          },
          break_duration : {
              required:true
          },
      },
      mounted() {
          if (this.status) {
              this.timer = setInterval(() => {
                  this.updateDiffs();
              },1000);
          }
          
          this.updateDiffs();
      },
      destroyed() {
          clearInterval(this.interval);
      },
      watch: {
          status(value) {
              if (!value) {
                  clearInterval(this.timer);
              }
              else {
                  this.timer = setInterval(() => {
                      this.updateDiffs();
                  },1000);
              }
          }
      },
      methods:{
          updateDiffs() {
              var now = Date.now();
              var diff = Math.abs(now - this.from.getTime());
              diff -= this.break_duration;
              this.hours = Math.floor(diff / this.intervals.hour);
              diff -= this.hours * this.intervals.hour;
              this.minutes = Math.floor(diff / this.intervals.minute);
              diff -= this.minutes * this.intervals.minute;
              this.seconds = Math.floor(diff / this.intervals.second);

              var hDisplay = this.hours < 10 ? "0"+this.hours : this.hours;
              var mDisplay = this.minutes < 10 ? "0"+this.minutes : this.minutes;
              var sDisplay = this.seconds < 10 ? "0"+this.seconds : this.seconds;

              this.time = hDisplay + ":" + mDisplay + ":" + sDisplay;
          }
      }
    })

    Vue.component('employee-break-timer', {
      // template: '<h1>Break {{formattedTimeLeft}}</h1>',
      template: '<h1></h1>',
      data() {
          return {
              timePassed: 0,
              timerInterval: null,
              remainingTime: 0
          }
      },
      props:{
          status : {
              required:true
          },
          time_limit : {
              required:true
          },
          break_id: {
              required:true
          }
      },
      computed: {
          formattedTimeLeft() {
              const timeLeft = this.timeLeft;
              const minutes = Math.floor(timeLeft / 60);
              let seconds = timeLeft % 60;

              if (seconds < 10) {
                  seconds = `0${seconds}`;
              }

              return `${minutes}:${seconds} mins`;
          },
          timeLeft() {
              var v = this.time_limit - this.timePassed;
              this.remainingTime = v;
              this.$emit("change", {id: this.break_id, remainingTime: v});
              return v;
          },
      },
      watch: {
          status(value) {
              if(value){
                  this.startTimer();
              }        
              else{
                  this.onTimesUp();
              }    
          },
          timeLeft(newValue) {
              if (newValue === 0) {
                  this.onTimesUp();
              }
          }
      },

      mounted() {
          if (this.status) {
              this.startTimer();
          }        
      },

      methods: {
          onTimesUp() {
          // clearInterval(this.timerInterval);
          },

          startTimer() {
          this.timerInterval = setInterval(() => (this.timePassed += 1), 1000);
          }
      }
    })

    new Vue({
      el: '#app',
      data: {
        csrf_token: '',
        timerVar: null,
        totalSeconds: 0,
        totalSecondsBreak: 0,
        logStatus: 'Check-in',
        breakList: [],

        employee_attendance: null,
        time_in_date: null,
        checkStatus: 'Check-in',
        checkColor: 'green',
        breakColor: 'primary',
        datenow: '',
        runningTime: 0,
        isRunning: false,
        interval: null,
        break_list: [],
        timer_status: false,
        current_break: -1,
        break_duration: 0,
        is_check_in: false,
        is_check_out: false,
        is_break: false,
        disable_checkStatus: false,
        break_time_limit: 0,
        current_break_id: 0,
        local_stored_break: {},
        tmp_employee_id: 1
      },

      watch: {
        timer_status(value) {
          var vm = this;

          if(vm.is_check_in == false){
            vm.checkStatus = 'Check-in';
            vm.checkColor = 'green'
            vm.disable_checkStatus = false;
          }
          else if(vm.is_check_in == true){
            vm.checkStatus = 'Check-out';
            vm.checkColor = 'red'
            vm.disable_checkStatus = false;
          }

          if(vm.is_break == true) {
            vm.checkStatus = 'Check-out'
            vm.checkColor = 'red'
            vm.disable_checkStatus = true;
          }
        },
        is_check_out(value){
          var vm = this;
          if(value == true){
            vm.checkStatus = 'Checked-out';
            vm.checkColor = 'red'
            vm.disable_checkStatus = true;
            vm.timer_status = false;
          }
        },
        is_break(value){
          var vm = this;
          if(value == true){
              vm.break_list.map((item, index) => {
                if(item.id === vm.current_break_id){                     
                    if(item.time_consume != null && item.time_consume != 0){
                        vm.$set(item,'remaining_seconds',item.time_consume);
                        vm.break_time_limit = item.time_consume;
                    }
                    else{
                        vm.local_stored_break = this.retrieveLocalStorageBreakRemainingSec(vm.current_break_id);
                        if(!isNaN(vm.local_stored_break.remaining_seconds)){
                          vm.$set(item,'remaining_seconds',vm.local_stored_break.remaining_seconds);
                          vm.break_time_limit = vm.local_stored_break.remaining_seconds;
                        }                
                        
                    }
                    vm.$set(item,'status',1);    
                    vm.$set(item,'is_disabled',false);            
                }
                else{
                  vm.$set(item,'is_disabled',true);
                  vm.$set(item,'status',0);              
                }
                this.checkBreakStatus(item.status);
            });
          }        

        }
      },

      created() {
        // this.getBreak()        
        this.getBreaks()
      },
      mounted(){
        var vm = this;

        vm.getCsrfToken();

        // this.getBreak()
        // this.totalSeconds = parseInt(localStorage.getItem('runningTime') ?? 0);
        // this.logStatus = localStorage.getItem('logStatus')
        // $('#btnLogCheckOut').hide();
        // if(this.totalSeconds > 0) {
        //   this.timerVar = setInterval(this.countTimer, 1000);
        //   window.$('#btnLogCheckOut').show();
        //   window.$('#btnLogCheckIn').hide();
        // }   

      },
      methods: {

        async getCsrfToken(){
          var vm = this;
            try {
              const response = await axios.get('http://localhost:8081/csrfToken');
              $('#_token').val(response.data)
              $("meta[name='csrf-token']").attr('content', response.data._token);

              axios.defaults.headers.common = {
                  'X-Requested-With': 'XMLHttpRequest',
                  'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
              };
              // vm.csrf_token = response.data
              console.log(response);
            }catch (error) {
              console.log('method: getCsrfToken');
              console.error(error);
            }
        },

        async getBreaks() {
            var vm = this;
            try {
              const response = await axios.get('http://localhost:8081/breaks');
              vm.break_list = response.data;
              // vm.checkAttendance(vm.$route.params.employee_id);
              // temporary
              vm.checkAttendance(1);
            }catch (error) {
              console.log('method: getBreaks');
              console.error(error);
            }
            
        },
        checkAttendance(id) {
            var vm = this;
            var today = new Date();
            var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
            var local_storage_is_break = '';

            try{

              axios.get('http://localhost:8081/employee/specific-attendance', {
                  params: {
                    employee_id : id, 
                    at_date: date 
                  }
              })
              .then((response) => {                
                  vm.employee_attendance = response.data.employee_attendance;
                  if(vm.employee_attendance) {
                    if(vm.employee_attendance.time_out == null){
                      var date = vm.employee_attendance.at_date + " " + vm.employee_attendance.time_in;
                      vm.time_in_date = new Date(date);
                      vm.timer_status = true;
                      vm.is_check_in = true;
                    }     
                    else{
                      vm.timer_status = false;
                      vm.is_check_out = true;
                    }         
                  }        
                  
                  

                  vm.break_list.map((item, index) => {
                      var status = 0;
                      var start_time = null;
                      var tmp_remaining_sec = '';
                      if(vm.employee_attendance) {                                 

                        vm.employee_attendance.break_details.map((detail,index2) => {
                          if(item.id === detail.break_id) {                      
                            if(detail.end_time != null && detail.start_time != null){  
                              status = 0;
                              start_time = detail.start_time;
                              vm.is_break = false;
                              vm.current_break_id = 0;      
                              tmp_remaining_sec = parseInt(detail.time_consume);                        
                              
                              var tmp_is_break = '';
                              if ("is_break" in localStorage) {                          
                                tmp_is_break = localStorage.getItem("is_break");
                                if(tmp_is_break === 'true'){
                                  vm.current_break = detail.break_id;
                                  status = 1;
                                  start_time = detail.start_time;
                                  vm.is_break = true;
                                  vm.current_break_id = item.id;
                                }
                                  
                              }                        
                            }
                            if(detail.end_time == null && detail.start_time != null){
                              // if user has break
                              vm.current_break = detail.break_id;
                              status = 1;
                              start_time = detail.start_time;
                              vm.is_break = true;
                              vm.current_break_id = item.id;    
                              tmp_remaining_sec = 0;           
                            }
                          }                    
                          
                        });
                      }                      
                      
                      
                      vm.$set(item,'status',status);
                      vm.$set(item,'start_time',start_time);                
                      vm.$set(item,'is_disabled',false);

                      var tmp = 0;
                      if(tmp_remaining_sec != '' && tmp_remaining_sec > 0){
                        tmp = vm.formattedTimeLeft(parseInt(tmp_remaining_sec));
                        vm.$set(item,'break_time',tmp);
                        vm.$set(item,'remaining_seconds',parseInt(tmp_remaining_sec));                 
                      }
                      else{                 
                        if(parseInt(tmp_remaining_sec) <= 0){
                            vm.$set(item,'is_disabled',true);
                            tmp = vm.formattedTimeLeft(parseInt(tmp_remaining_sec));
                            vm.$set(item,'break_time',tmp);
                            vm.$set(item,'remaining_seconds',parseInt(tmp_remaining_sec));                      
                        }
                        else{
                            vm.$set(item,'remaining_seconds',(item.break_time * 60));
                        }

                        
                      }
                      
                  });

              }, (error) => {
                console.log(error);
              });

            }catch (error) {
              console.log('method: checkAttendance');
              console.error(error);
            }           
            
        },

        checkBreakStatusIcon(value){
            // ni ni-button-play
            if (value == 1) {
              return 'ni ni-button-pause';
            }
            if (value == 0) {
              return 'ni ni-button-play';
            }
            if (value == 2) {
              return 'ni ni-button-play';
            }
        },

        checkBreakStatus(value) {
          if (value == 1) {
            return 'btn btn-danger';
          }
          if (value == 0) {
            return 'btn btn-success';
          }
          if (value == 2) {
            return 'btn btn-secondary';
          }
        },
        changeBreakStatus(data) {
          if(data.status == 0) {
            this.breakIn(data);
          }
          else if(data.status == 1) {
            this.breakOut(data);
          }
        },
        breakIn(data) {
          var vm = this;
          var today = new Date();
          var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
          var time = today.getHours()+':'+today.getMinutes()+':'+today.getSeconds();
          var start_time = date + " " + time;

          axios.post('http://localhost:8081/employee/break-in', {
              attendance_id : vm.employee_attendance.id,
              start_time: start_time,
              break_id: data.id
          })
          .then((response) => {
            vm.is_break = true;
            vm.timer_status = false;
            vm.break_time_limit = data.remaining_seconds;
            vm.current_break_id = data.id;
            vm.disable_checkStatus = true;

            vm.break_list.map((item, index) => {
                if(item.id === data.id){
                  vm.$set(item,'status',1);
                }
                else{
                  vm.$set(item,'is_disabled',true);
                }
            });
          }, (error) => {
            console.log(error);
          });
        },
        breakOut(data) {
          var vm = this;        

          var today = new Date();
          var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
          var time = today.getHours()+':'+today.getMinutes()+':'+today.getSeconds();
          var end_time = date + " " + time;

          // var start_time = new Date(data.start_time);
          // var diff = Math.abs(today.getTime() - start_time.getTime());
          // var time_consume = Math.floor(diff / 1000);

          var time_consume = 0;

          vm.break_list.map((item, index) => {
              if(item.id === data.id){
                  time_consume = item.remaining_seconds;
              }            
          });

          axios.post('http://localhost:8081/employee/break-out', {
              attendance_id : vm.employee_attendance.id,
              end_time: end_time,
              break_id: data.id,
              time_consume: time_consume
          })
          .then((response) => {            
              vm.removeLocalStorageBreakRemainingSec(); 
              vm.is_break = false;
              vm.timer_status = true;
              vm.disable_checkStatus = false;

              vm.break_list.map((item, index) => {
                  if(item.id === data.id){

                    var tmp = 0;
                    if(item.remaining_seconds <= 0){
                        vm.$set(item,'is_disabled',true);
                        tmp = vm.formattedTimeLeft(parseInt(tmp_remaining_sec));
                        vm.$set(item,'break_time',tmp);
                        vm.$set(item,'remaining_seconds',parseInt(tmp_remaining_sec)); 
                        vm.$set(item,'status',0);
                    }      
                    else{
                      vm.$set(item,'status',0);
                      vm.$set(item,'is_disabled',false);
                    }                     
                  }
                  else{
                    vm.$set(item,'is_disabled',false);
                    vm.$set(item,'status',0);
                  }
              });
          }, (error) => {
            console.log(error);
          });
        },
        removeLocalStorageBreakRemainingSec(){
            localStorage.removeItem('is_break');
            localStorage.removeItem('break_id');
            localStorage.removeItem('remaining_seconds');
        },

        localStorageBreakRemainingSec(break_id, sec){
          var vm = this;
          if (typeof(Storage) !== "undefined") {
              localStorage.setItem("is_break", vm.is_break);
              localStorage.setItem("break_id", break_id);
              localStorage.setItem("remaining_seconds", sec);
              return true;
          } 
          else{
            console.log('Browser doesn\'t support web storage');
            return false;
          }
        },

        retrieveLocalStorageBreakRemainingSec(break_id){
            if ("break_id" in localStorage) {
              if(break_id == localStorage.getItem("break_id")){
                return {'break_id': localStorage.getItem("break_id"), 'remaining_seconds': localStorage.getItem("remaining_seconds"), 'is_break': localStorage.getItem("is_break")};
              }            
              
            }
            return false;
        },

        formattedTimeLeft(timeLeft) {
            const minutes = Math.floor(timeLeft / 60);
            let seconds = timeLeft % 60;

            if (seconds < 10) {
                seconds = `0${seconds}`;
            }

            return `${minutes}:${seconds}`;
        },

        updateRemainingTime(data){
            var vm = this;
            vm.break_list.map((item, index) => {
                if(item.id === data.id){
                  vm.$set(item,'remaining_seconds',data.remainingTime);
                  vm.$set(item,'break_time',vm.formattedTimeLeft(data.remainingTime));
                  vm.localStorageBreakRemainingSec(data.id, data.remainingTime);
                }
            });

        },
        dateText(date) {
          if(date){
            var d = this.time_in_date;
            d = moment().format("lll");
            return d;
          }
        },

        changeTimeInStatus(value) {
          if (value) {
            this.timeOut();
          }
          else {          
            this.timeIn();
          }
        },

        timeIn() {
          var vm = this;
          var id = vm.tmp_employee_id; //this.$route.params.employee_id;
          var today = new Date();
          var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
          var time = today.getHours()+':'+today.getMinutes()+':'+today.getSeconds();  

          axios.post('http://localhost:8081/employee/time-in', {
              employee_id : id,
              date: date,
              time: time
          })
          .then((response) => {

            vm.employee_attendance = response.data.employee_attendance;              
              if(vm.employee_attendance) {
                var date = vm.employee_attendance.at_date + " " + vm.employee_attendance.time_in;
                vm.time_in_date = new Date(date);
                vm.timer_status = true;
                vm.is_check_in = true;
              }

          }).catch(function(error){
            console.log(error);
          });
        },
        timeOut() {
          var vm = this;
          var id = vm.tmp_employee_id; //this.$route.params.employee_id;
          var today = new Date();
          var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
          var time = today.getHours()+':'+today.getMinutes()+':'+today.getSeconds();      
          
          axios.post('http://localhost:8081/employee/time-out', {
              employee_id : id,
              date: date,
              time: time
          })
          .then((response) => {

              vm.removeLocalStorageBreakRemainingSec(); 
              vm.employee_attendance = response.data.employee_attendance;            
              if(vm.employee_attendance) {
                var date = vm.employee_attendance.at_date + " " + vm.employee_attendance.time_in;
                vm.time_in_date = new Date(date);
                vm.timer_status = false;
                vm.is_check_out = true;
              }

              vm.break_list.map((item, index) => {
                  vm.$set(item,'is_disabled',true);
              });

          }).catch(function(error){
            console.log(error);
          });
        },



        async getBreak() {
          try {
            const response = await axios.get('http://localhost:8081/breaks');
            this.breakList = response.data
            this.break_list = response.data

            this.breakList.forEach(element => {              

            const element_stringify = JSON.stringify(JSON.stringify(element));

            const div =  + '<div >'
                + '<div class="card card-stats">'
                  + '<div class="card-body">'
                    + '<div class="row">'
                      + '<div class="col">'
                        + '<h5 class="card-title text-uppercase text-muted mb-0">'+element.name+'</h5>'
                        + '<span class="h1 font-weight-bold mb-0">'+element.break_time+'</span>'
                      + '</div>'
                      + '<div class="col-auto">'
                        + '<input class="mt-4 breakBtn" type="radio" name="option" value="option1" data-breakinfo="'+ element_stringify +'">'
                      + '</div>'
                    + '</div>'
                  + '</div>'
                + '</div>'
              + '</div>'

              
            // const div =  `<div >
            //     <div class="card card-stats">
            //       <div class="card-body">
            //         <div class="row">
            //           <div class="col">
            //             <h5 class="card-title text-uppercase text-muted mb-0">${element.name}</h5>
            //             <span class="h1 font-weight-bold mb-0">${element.break_time}</span>
            //           </div>
            //           <div class="col-auto">
            //             <input class="mt-4" type="radio" name="option" value="option1">
            //           </div>
            //         </div>
            //       </div>
            //     </div>
            //   </div>`

              // $('#breakContent').append(div)

            });
          } catch (error) {
            console.error(error);
          }
        },
        // countTimer() {
        //    ++this.totalSeconds;
        //    var hour = Math.floor(this.totalSeconds /3600);
        //    var minute = Math.floor((this.totalSeconds - hour*3600)/60);
        //    var seconds = this.totalSeconds - (hour*3600 + minute*60);
        //    if(hour < 10)
        //      hour = "0"+hour;
        //    if(minute < 10)
        //      minute = "0"+minute;
        //    if(seconds < 10)
        //      seconds = "0"+seconds;
        //      localStorage.setItem("runningTime", this.totalSeconds);
        //      document.getElementById("timer").innerHTML = hour + ":" + minute + ":" + seconds;
        // },
        // countTimerBreaks() {
        //    --this.totalSecondsBreak;
        //    var hour = Math.floor(this.totalSecondsBreak /3600);
        //    var minute = Math.floor((this.totalSecondsBreak - hour*3600)/60);
        //    var seconds = this.totalSecondsBreak - (hour*3600 + minute*60);
        //    if(hour < 10)
        //      hour = "0"+hour;
        //    if(minute < 10)
        //      minute = "0"+minute;
        //    if(seconds < 10)
        //      seconds = "0"+seconds;
        //      localStorage.setItem("runningTimeBreak", this.totalSecondsBreak);
        //      document.getElementById("timer").innerHTML = hour + ":" + minute + ":" + seconds;
        // },
        // radioBreak() {
        //   clearInterval(this.timerVar)
        // },
        // btnLogCheckIn() {
        //   this.timerVar = setInterval(this.countTimer, 1000);
        //   this.totalSeconds = parseInt(localStorage.getItem('runningTime') ?? 0);
        //   this.logStatus = 'Check-out'
        //   localStorage.setItem("logStatus", 'Check-out');
        //   window.$('#btnLogCheckOut').show();
        //   window.$('#btnLogCheckIn').hide();
        // },
        // btnLogCheckOut() {
        //   this.logStatus = 'Check-in'
        //   localStorage.setItem("logStatus", 'Check-in');
        //   window.$('#btnLogCheckOut').hide();
        //   window.$('#btnLogCheckIn').show();
        //   clearInterval(this.timerVar)
        // },
      },
    })
    
     
     
    //METHOD

    

    // function countTimer() {
    //        ++totalSeconds;
    //        var hour = Math.floor(totalSeconds /3600);
    //        var minute = Math.floor((totalSeconds - hour*3600)/60);
    //        var seconds = totalSeconds - (hour*3600 + minute*60);
    //        if(hour < 10)
    //          hour = "0"+hour;
    //        if(minute < 10)
    //          minute = "0"+minute;
    //        if(seconds < 10)
    //          seconds = "0"+seconds;
    //          localStorage.setItem("runningTime", totalSeconds);
    //        document.getElementById("timer").innerHTML = hour + ":" + minute + ":" + seconds;
    //     }

    // $("#btnLogCheckIn").click(function(){
    //   timerVar = setInterval(countTimer, 1000);
    //   totalSeconds = parseInt(localStorage.getItem('runningTime') ?? 0);
    //   localStorage.setItem("logStatus", 'Check-out');
    //   $('#btnLogCheckOut').show();
    //   $('#btnLogCheckIn').hide();
    // });

    // $("#btnLogCheckOut").click(function(){
    //   localStorage.setItem("logStatus", 'Check-in');
    //   $('#btnLogCheckOut').hide();
    //   $('#btnLogCheckIn').show();
    // });


    // //MOUNTED
    // var timerVar = null;
    // var totalSeconds = parseInt(localStorage.getItem('runningTime') ?? 0);
    // $('#logStatus').html(localStorage.getItem('logStatus') ?? 'Check-in');
    // $('#btnLogCheckOut').hide();
    // getBreak();
    // if(totalSeconds > 0) {
    //   timerVar = setInterval(countTimer, 1000);
    //   $('#btnLogCheckOut').show();
    //   $('#btnLogCheckIn').hide();
    // }
    
  </script>
</body>

</html>
